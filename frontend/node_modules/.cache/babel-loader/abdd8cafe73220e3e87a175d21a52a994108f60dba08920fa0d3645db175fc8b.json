{"ast":null,"code":"class WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.gameId = null;\n    this.playerName = null;\n    this.messageHandlers = new Map();\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 3000;\n  }\n  connect(gameId, playerName) {\n    this.gameId = gameId;\n    this.playerName = playerName;\n    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsHost = process.env.REACT_APP_WS_HOST || 'localhost:8000';\n    const wsUrl = `${wsProtocol}//${wsHost}/ws/${gameId}/${encodeURIComponent(playerName)}`;\n    this.socket = new WebSocket(wsUrl);\n    this.socket.onopen = () => {\n      console.log('WebSocket connected');\n      this.reconnectAttempts = 0;\n      this.emit('connected');\n    };\n    this.socket.onmessage = event => {\n      try {\n        const message = JSON.parse(event.data);\n        this.handleMessage(message);\n      } catch (error) {\n        console.error('Error parsing message:', error);\n      }\n    };\n    this.socket.onerror = error => {\n      console.error('WebSocket error:', error);\n      this.emit('error', error);\n    };\n    this.socket.onclose = () => {\n      console.log('WebSocket disconnected');\n      this.emit('disconnected');\n      this.attemptReconnect();\n    };\n  }\n  attemptReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      setTimeout(() => {\n        console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\n        if (this.gameId && this.playerName) {\n          this.connect(this.gameId, this.playerName);\n        }\n      }, this.reconnectDelay);\n    } else {\n      console.error('Max reconnection attempts reached');\n      this.emit('reconnect_failed');\n    }\n  }\n  handleMessage(message) {\n    const {\n      type,\n      payload\n    } = message;\n\n    // Call all handlers for this message type\n    if (this.messageHandlers.has(type)) {\n      this.messageHandlers.get(type).forEach(handler => {\n        try {\n          handler(payload);\n        } catch (error) {\n          console.error(`Error in message handler for ${type}:`, error);\n        }\n      });\n    }\n\n    // Also emit a general message event\n    this.emit('message', {\n      type,\n      payload\n    });\n  }\n  on(type, handler) {\n    if (!this.messageHandlers.has(type)) {\n      this.messageHandlers.set(type, []);\n    }\n    this.messageHandlers.get(type).push(handler);\n  }\n  off(type, handler) {\n    if (this.messageHandlers.has(type)) {\n      const handlers = this.messageHandlers.get(type);\n      const index = handlers.indexOf(handler);\n      if (index > -1) {\n        handlers.splice(index, 1);\n      }\n    }\n  }\n  emit(event, data) {\n    // Simple event emitter pattern\n    if (!this._eventHandlers) {\n      this._eventHandlers = new Map();\n    }\n    if (this._eventHandlers.has(event)) {\n      this._eventHandlers.get(event).forEach(handler => handler(data));\n    }\n  }\n  addEventListener(event, handler) {\n    if (!this._eventHandlers) {\n      this._eventHandlers = new Map();\n    }\n    if (!this._eventHandlers.has(event)) {\n      this._eventHandlers.set(event, []);\n    }\n    this._eventHandlers.get(event).push(handler);\n  }\n  removeEventListener(event, handler) {\n    if (this._eventHandlers && this._eventHandlers.has(event)) {\n      const handlers = this._eventHandlers.get(event);\n      const index = handlers.indexOf(handler);\n      if (index > -1) {\n        handlers.splice(index, 1);\n      }\n    }\n  }\n  send(action, payload = {}) {\n    if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n      this.socket.send(JSON.stringify({\n        action,\n        payload\n      }));\n    } else {\n      console.error('WebSocket is not connected');\n    }\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n    this.gameId = null;\n    this.playerName = null;\n    this.messageHandlers.clear();\n  }\n  isConnected() {\n    return this.socket && this.socket.readyState === WebSocket.OPEN;\n  }\n}\nexport default new WebSocketService();","map":{"version":3,"names":["WebSocketService","constructor","socket","gameId","playerName","messageHandlers","Map","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","wsProtocol","window","location","protocol","wsHost","process","env","REACT_APP_WS_HOST","wsUrl","encodeURIComponent","WebSocket","onopen","console","log","emit","onmessage","event","message","JSON","parse","data","handleMessage","error","onerror","onclose","attemptReconnect","setTimeout","type","payload","has","get","forEach","handler","on","set","push","off","handlers","index","indexOf","splice","_eventHandlers","addEventListener","removeEventListener","send","action","readyState","OPEN","stringify","disconnect","close","clear","isConnected"],"sources":["C:/Users/Thomas/Desktop/Coding Projects/Python/Secret-Hitler-App/frontend/src/services/websocket.js"],"sourcesContent":["class WebSocketService {\r\n  constructor() {\r\n    this.socket = null;\r\n    this.gameId = null;\r\n    this.playerName = null;\r\n    this.messageHandlers = new Map();\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 3000;\r\n  }\r\n\r\n  connect(gameId, playerName) {\r\n    this.gameId = gameId;\r\n    this.playerName = playerName;\r\n    \r\n    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n    const wsHost = process.env.REACT_APP_WS_HOST || 'localhost:8000';\r\n    const wsUrl = `${wsProtocol}//${wsHost}/ws/${gameId}/${encodeURIComponent(playerName)}`;\r\n    \r\n    this.socket = new WebSocket(wsUrl);\r\n    \r\n    this.socket.onopen = () => {\r\n      console.log('WebSocket connected');\r\n      this.reconnectAttempts = 0;\r\n      this.emit('connected');\r\n    };\r\n    \r\n    this.socket.onmessage = (event) => {\r\n      try {\r\n        const message = JSON.parse(event.data);\r\n        this.handleMessage(message);\r\n      } catch (error) {\r\n        console.error('Error parsing message:', error);\r\n      }\r\n    };\r\n    \r\n    this.socket.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n      this.emit('error', error);\r\n    };\r\n    \r\n    this.socket.onclose = () => {\r\n      console.log('WebSocket disconnected');\r\n      this.emit('disconnected');\r\n      this.attemptReconnect();\r\n    };\r\n  }\r\n\r\n  attemptReconnect() {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      setTimeout(() => {\r\n        console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\r\n        if (this.gameId && this.playerName) {\r\n          this.connect(this.gameId, this.playerName);\r\n        }\r\n      }, this.reconnectDelay);\r\n    } else {\r\n      console.error('Max reconnection attempts reached');\r\n      this.emit('reconnect_failed');\r\n    }\r\n  }\r\n\r\n  handleMessage(message) {\r\n    const { type, payload } = message;\r\n    \r\n    // Call all handlers for this message type\r\n    if (this.messageHandlers.has(type)) {\r\n      this.messageHandlers.get(type).forEach(handler => {\r\n        try {\r\n          handler(payload);\r\n        } catch (error) {\r\n          console.error(`Error in message handler for ${type}:`, error);\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Also emit a general message event\r\n    this.emit('message', { type, payload });\r\n  }\r\n\r\n  on(type, handler) {\r\n    if (!this.messageHandlers.has(type)) {\r\n      this.messageHandlers.set(type, []);\r\n    }\r\n    this.messageHandlers.get(type).push(handler);\r\n  }\r\n\r\n  off(type, handler) {\r\n    if (this.messageHandlers.has(type)) {\r\n      const handlers = this.messageHandlers.get(type);\r\n      const index = handlers.indexOf(handler);\r\n      if (index > -1) {\r\n        handlers.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  emit(event, data) {\r\n    // Simple event emitter pattern\r\n    if (!this._eventHandlers) {\r\n      this._eventHandlers = new Map();\r\n    }\r\n    if (this._eventHandlers.has(event)) {\r\n      this._eventHandlers.get(event).forEach(handler => handler(data));\r\n    }\r\n  }\r\n\r\n  addEventListener(event, handler) {\r\n    if (!this._eventHandlers) {\r\n      this._eventHandlers = new Map();\r\n    }\r\n    if (!this._eventHandlers.has(event)) {\r\n      this._eventHandlers.set(event, []);\r\n    }\r\n    this._eventHandlers.get(event).push(handler);\r\n  }\r\n\r\n  removeEventListener(event, handler) {\r\n    if (this._eventHandlers && this._eventHandlers.has(event)) {\r\n      const handlers = this._eventHandlers.get(event);\r\n      const index = handlers.indexOf(handler);\r\n      if (index > -1) {\r\n        handlers.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  send(action, payload = {}) {\r\n    if (this.socket && this.socket.readyState === WebSocket.OPEN) {\r\n      this.socket.send(JSON.stringify({ action, payload }));\r\n    } else {\r\n      console.error('WebSocket is not connected');\r\n    }\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.socket) {\r\n      this.socket.close();\r\n      this.socket = null;\r\n    }\r\n    this.gameId = null;\r\n    this.playerName = null;\r\n    this.messageHandlers.clear();\r\n  }\r\n\r\n  isConnected() {\r\n    return this.socket && this.socket.readyState === WebSocket.OPEN;\r\n  }\r\n}\r\n\r\nexport default new WebSocketService();\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}